# cargo_parser

`cargo_parser`- приложение для парсинга условий грузоперевозок одной из логистических компаний. Приложение позволяет спарсить цены по желаемым маршрутам, задав нужные параметры перевозки и дополнителных услуг.

## Системные требования
- Python 3.11+
- Works on Linux, Windows, macOS

## Основные технологии:
- Python 3.11
- Pydantic
- openpyxl
- aiohttp

## Как запустить проект:
Необходимо выполнить следующие шаги:
- Склонируйте репозиторий с GitHub и перейдите в папку приложения:
```
git@github.com:KostKH/cargo_parser.git
cd cargo_parser
```
- Создайте и активируйте виртуальное окружение, установите зависимости:
```
в Windows:
py -3.11 -m venv venv
source venv/scripts/activate
pip install -r requirements.txt

в Linux:
python3.11 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```
- В папку `data_input` сохраните следующие файлы в формате `csv`:
* Файл со списком маршрутов: (образец - `routes.csv`)
* Файл со списком параметров: (образец - `params.csv`)
* Файл с токеном

- Запустите приложение (в качестве имен файлов укажите свои):
```
python main.py --token-mode 'token.csv' --routes 'routes.csv' --params 'params.csv'
```


## Где взять токен
Чтобы получить токен, вам надо залогиниться на сайте перевозчика, открыть в браузере инструменты разработчика, сформировать запрос на какие-либо условия перевозки, найти на вкладке Network запрос api перевозкика, и в заголовках реквеста взять токен. Токен будет действовать около 2-х дней.

## Какие услуги включены в реализованном интерфейсе
Для каждого маршрута отправляются запросы со следующими параметрами груза и доп.услуг:
- 0.5 кг (Короб) + страховка 999руб + упаковка: короб 0.5 кг
- 2 кг (Короб)+ страховка 999руб + упаковка: 1 шт. короб 2 кг
- 3 кг (Короб)+ страховка 999руб + упаковка: 1 шт. короб 5 кг
- 4 кг (Короб)+ страховка 999руб + упаковка: 1 шт. короб 5 кг
- 5 кг (Короб)+ страховка 999руб + упаковка: 1 шт. короб 5 кг
- 20 кг (Короб)+ страховка 999руб + упаковка: 4 шт. короб 5 кг

При необходимости, эти параметры можно изменитьв файле interface/dictionaries.py

В Файле 'params.csv' по-умолчанию заданы следующие значения:
- mode: HOME-HOME (Режим доставки от двери до двери)
- cargo_type_descr: Экспресс-доставка ко времени
- tariff_description: 16:00 (доставка к 16:00)

## Описание параметров

* `--token-mode`: Параметр для активации парсинга по токену и передачи в парсер файла с токеном.
* `--routes`: параметр для передачи в парсер списка маршрутов на парсинг.
* `--params`: Параметр для передачи в парсер файла с настройками для парсера: mode, cargo_type_descr и tariff_description.

## Технические и архитектурные детали:

Приложение написано с использованием луковичной архитектуры и паттерна "Репозиторий".
В приложении выделено 3 слоя: слой работы с хранилищем данных (репозиторий), слой предметной области (модели, парсеры) и слой интерфейса приложения. Слой предметной области независим от репозитория и от интерфейса.

## О программе:

Автор: Константин Харьков